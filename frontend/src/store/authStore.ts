import { create } from 'zustand'\nimport { persist } from 'zustand/middleware'\nimport {\n  User,\n  AuthTokens,\n  LoginPayload,\n  SignUpPayload,\n  ChangePasswordPayload,\n  PasswordResetRequest,\n  PasswordResetConfirm,\n  EmailVerification,\n} from '@/types/user'\nimport { authAPI, userAPI } from '@/lib/api'\n\ninterface AuthState {\n  // State\n  user: User | null\n  tokens: AuthTokens | null\n  isLoading: boolean\n  error: string | null\n  isAuthenticated: boolean\n\n  // Actions\n  register: (payload: SignUpPayload) => Promise<void>\n  login: (payload: LoginPayload) => Promise<void>\n  logout: () => Promise<void>\n  verifyEmail: (payload: EmailVerification) => Promise<void>\n  requestPasswordReset: (payload: PasswordResetRequest) => Promise<void>\n  confirmPasswordReset: (payload: PasswordResetConfirm) => Promise<void>\n  changePassword: (payload: ChangePasswordPayload) => Promise<void>\n  updateProfile: (payload: Partial<User>) => Promise<void>\n  getCurrentUser: () => Promise<void>\n  setTokens: (tokens: AuthTokens) => void\n  setUser: (user: User | null) => void\n  clearError: () => void\n  reset: () => void\n}\n\nexport const useAuthStore = create<AuthState>(\n  persist(\n    (set, get) => ({\n      // Initial state\n      user: null,\n      tokens: null,\n      isLoading: false,\n      error: null,\n      isAuthenticated: false,\n\n      // Register\n      register: async (payload: SignUpPayload) => {\n        set({ isLoading: true, error: null })\n        try {\n          const response = await authAPI.register(payload)\n          set({\n            user: response.user,\n            tokens: response.tokens,\n            isAuthenticated: true,\n            isLoading: false,\n          })\n        } catch (error: any) {\n          const errorMessage =\n            error.response?.data?.detail ||\n            error.response?.data?.email?.[0] ||\n            error.response?.data?.password?.[0] ||\n            'Registration failed'\n          set({ error: errorMessage, isLoading: false })\n          throw error\n        }\n      },\n\n      // Login\n      login: async (payload: LoginPayload) => {\n        set({ isLoading: true, error: null })\n        try {\n          const response = await authAPI.login(payload)\n          set({\n            user: response.user,\n            tokens: response.tokens,\n            isAuthenticated: true,\n            isLoading: false,\n          })\n        } catch (error: any) {\n          const errorMessage =\n            error.response?.data?.detail || 'Login failed'\n          set({ error: errorMessage, isLoading: false })\n          throw error\n        }\n      },\n\n      // Logout\n      logout: async () => {\n        set({ isLoading: true, error: null })\n        try {\n          const { tokens } = get()\n          if (tokens?.refresh) {\n            await authAPI.logout(tokens.refresh)\n          }\n          set({\n            user: null,\n            tokens: null,\n            isAuthenticated: false,\n            isLoading: false,\n          })\n          localStorage.removeItem('access_token')\n          localStorage.removeItem('refresh_token')\n        } catch (error: any) {\n          const errorMessage = error.response?.data?.detail || 'Logout failed'\n          set({ error: errorMessage, isLoading: false })\n          throw error\n        }\n      },\n\n      // Verify email\n      verifyEmail: async (payload: EmailVerification) => {\n        set({ isLoading: true, error: null })\n        try {\n          const response = await authAPI.verifyEmail(payload)\n          set({\n            user: response.user,\n            isLoading: false,\n          })\n        } catch (error: any) {\n          const errorMessage =\n            error.response?.data?.detail ||\n            error.response?.data?.token?.[0] ||\n            'Email verification failed'\n          set({ error: errorMessage, isLoading: false })\n          throw error\n        }\n      },\n\n      // Request password reset\n      requestPasswordReset: async (payload: PasswordResetRequest) => {\n        set({ isLoading: true, error: null })\n        try {\n          await authAPI.requestPasswordReset(payload)\n          set({ isLoading: false })\n        } catch (error: any) {\n          const errorMessage =\n            error.response?.data?.detail ||\n            error.response?.data?.email?.[0] ||\n            'Password reset request failed'\n          set({ error: errorMessage, isLoading: false })\n          throw error\n        }\n      },\n\n      // Confirm password reset\n      confirmPasswordReset: async (payload: PasswordResetConfirm) => {\n        set({ isLoading: true, error: null })\n        try {\n          await authAPI.confirmPasswordReset(payload)\n          set({ isLoading: false })\n        } catch (error: any) {\n          const errorMessage =\n            error.response?.data?.detail ||\n            error.response?.data?.token?.[0] ||\n            'Password reset confirmation failed'\n          set({ error: errorMessage, isLoading: false })\n          throw error\n        }\n      },\n\n      // Change password\n      changePassword: async (payload: ChangePasswordPayload) => {\n        set({ isLoading: true, error: null })\n        try {\n          await userAPI.changePassword(payload)\n          set({ isLoading: false })\n        } catch (error: any) {\n          const errorMessage =\n            error.response?.data?.detail ||\n            error.response?.data?.old_password?.[0] ||\n            'Password change failed'\n          set({ error: errorMessage, isLoading: false })\n          throw error\n        }\n      },\n\n      // Update profile\n      updateProfile: async (payload: Partial<User>) => {\n        set({ isLoading: true, error: null })\n        try {\n          const updatedUser = await userAPI.updateProfile(payload)\n          set({\n            user: updatedUser,\n            isLoading: false,\n          })\n        } catch (error: any) {\n          const errorMessage = error.response?.data?.detail || 'Profile update failed'\n          set({ error: errorMessage, isLoading: false })\n          throw error\n        }\n      },\n\n      // Get current user\n      getCurrentUser: async () => {\n        set({ isLoading: true, error: null })\n        try {\n          const user = await userAPI.getCurrentUser()\n          set({\n            user,\n            isAuthenticated: true,\n            isLoading: false,\n          })\n        } catch (error: any) {\n          set({ isLoading: false, isAuthenticated: false })\n          throw error\n        }\n      },\n\n      // Set tokens\n      setTokens: (tokens: AuthTokens) => {\n        set({ tokens, isAuthenticated: true })\n        localStorage.setItem('access_token', tokens.access)\n        localStorage.setItem('refresh_token', tokens.refresh)\n      },\n\n      // Set user\n      setUser: (user: User | null) => {\n        set({ user })\n      },\n\n      // Clear error\n      clearError: () => {\n        set({ error: null })\n      },\n\n      // Reset all state\n      reset: () => {\n        set({\n          user: null,\n          tokens: null,\n          isLoading: false,\n          error: null,\n          isAuthenticated: false,\n        })\n        localStorage.removeItem('access_token')\n        localStorage.removeItem('refresh_token')\n      },\n    }),\n    {\n      name: 'auth-storage',\n      partialize: (state) => ({\n        user: state.user,\n        tokens: state.tokens,\n        isAuthenticated: state.isAuthenticated,\n      }),\n    }\n  )\n)\n"
